import{_ as te,r as _,b as L,s as oe,k as B,o as u,g as l,w as t,e as n,E as p,G as re,h as ne,D as se,q as ue,j as s,d as m,m as x,t as de,i as ie,l as pe,F as me,v as fe,U as T,K as $}from"./index-Dg0MfX17.js";import{g as ge,a as ce,b as ye,d as ve,e as be,f as _e}from"./user-hoTlkoqH.js";import{f as Ve}from"./supplier-Brz4Qjp8.js";const we={class:"page-container"},ke={class:"search-bar"},Ue={__name:"List",setup(xe){const N=_(!1),R=_([]),V=_(!1),S=_(!1),C=_(null),z=_([]),w=_(!1),P=_("新建用户"),d=L({username:"",role:"",status:void 0}),g=L({page:1,size:10,total:0}),M={id:null,username:"",password:"",realName:"",phone:"",email:"",role:"SUPPLIER",supplierId:null,status:0},r=L({...M}),A={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},y=async()=>{N.value=!0;try{const o=await ge({page:g.page,size:g.size,username:d.username,role:d.role,status:d.status});R.value=o.records,g.total=o.total}catch(o){console.error("加载数据失败",o),p.error("加载用户列表失败")}finally{N.value=!1}},q=async()=>{try{const o=await Ve();z.value=o}catch(o){console.error("加载供应商列表失败",o),p.error("加载供应商列表失败")}},D=()=>{g.page=1,y()},j=()=>{d.username="",d.role="",d.status=void 0,D()},F=()=>{Object.assign(r,M),w.value=!1,P.value="新建用户",V.value=!0,T(()=>{var o;(o=C.value)==null||o.clearValidate()})},K=o=>{Object.assign(r,o),w.value=!0,P.value="编辑用户",V.value=!0,T(()=>{var e;(e=C.value)==null||e.clearValidate()})},O=async()=>{var o;try{await((o=C.value)==null?void 0:o.validate()),S.value=!0,w.value?(await be(r.id,r),p.success("更新成功")):(await _e(r),p.success("创建成功")),V.value=!1,y()}catch(e){console.error("提交失败",e),p.error("提交失败")}finally{S.value=!1}},G=async o=>{try{const e=o.status===1?2:1;await ce(o.id,e),p.success("状态更新成功"),y()}catch(e){console.error("更新状态失败",e),p.error("更新状态失败")}},h=async(o,e)=>{try{await $.confirm(`确认将用户 ${o.username} 设为 ${e==="ADMIN"?"管理员":"供应商"} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ye(o.id,e),p.success("角色更新成功"),y()}catch(c){c!=="cancel"&&(console.error("更新角色失败",c),p.error("更新角色失败"))}},H=async o=>{try{await $.confirm("确认删除该用户吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ve(o),p.success("删除成功"),y()}catch(e){e!=="cancel"&&(console.error("删除失败",e),p.error("删除失败"))}};return oe(()=>{y(),q()}),(o,e)=>{const c=n("el-input"),i=n("el-option"),k=n("el-select"),v=n("el-button"),f=n("el-table-column"),U=n("el-tag"),J=n("el-icon"),E=n("el-dropdown-item"),Q=n("el-dropdown-menu"),W=n("el-dropdown"),X=n("el-table"),Y=n("el-pagination"),Z=n("el-card"),b=n("el-form-item"),ee=n("el-form"),le=n("el-dialog"),ae=re("loading");return u(),B("div",we,[l(Z,null,{default:t(()=>[ne("div",ke,[l(c,{modelValue:d.username,"onUpdate:modelValue":e[0]||(e[0]=a=>d.username=a),placeholder:"搜索用户名",style:{width:"200px","margin-right":"10px"},clearable:"",onKeyup:ue(D,["enter"])},null,8,["modelValue"]),l(k,{modelValue:d.role,"onUpdate:modelValue":e[1]||(e[1]=a=>d.role=a),placeholder:"角色",style:{width:"120px","margin-right":"10px"},clearable:""},{default:t(()=>[l(i,{label:"管理员",value:"ADMIN"}),l(i,{label:"供应商",value:"SUPPLIER"})]),_:1},8,["modelValue"]),l(k,{modelValue:d.status,"onUpdate:modelValue":e[2]||(e[2]=a=>d.status=a),placeholder:"状态",style:{width:"120px","margin-right":"10px"},clearable:""},{default:t(()=>[l(i,{label:"待审核",value:0}),l(i,{label:"正常",value:1}),l(i,{label:"禁用",value:2})]),_:1},8,["modelValue"]),l(v,{type:"primary",onClick:D},{default:t(()=>[...e[15]||(e[15]=[s("搜索",-1)])]),_:1}),l(v,{onClick:j},{default:t(()=>[...e[16]||(e[16]=[s("重置",-1)])]),_:1}),l(v,{type:"success",onClick:F,style:{float:"right"}},{default:t(()=>[...e[17]||(e[17]=[s("新建用户",-1)])]),_:1})]),se((u(),m(X,{data:R.value,style:{width:"100%","margin-top":"20px"}},{default:t(()=>[l(f,{prop:"id",label:"ID",width:"80"}),l(f,{prop:"username",label:"用户名",width:"150"}),l(f,{prop:"realName",label:"真实姓名",width:"120"}),l(f,{prop:"phone",label:"手机号",width:"130"}),l(f,{prop:"email",label:"邮箱","min-width":"180"}),l(f,{prop:"role",label:"角色",width:"120"},{default:t(({row:a})=>[a.role==="ADMIN"?(u(),m(U,{key:0,type:"danger"},{default:t(()=>[...e[18]||(e[18]=[s("管理员",-1)])]),_:1})):a.role==="SUPPLIER"?(u(),m(U,{key:1,type:"primary"},{default:t(()=>[...e[19]||(e[19]=[s("供应商",-1)])]),_:1})):x("",!0)]),_:1}),l(f,{prop:"supplierName",label:"关联供应商","min-width":"180"}),l(f,{prop:"status",label:"状态",width:"100"},{default:t(({row:a})=>[a.status===1?(u(),m(U,{key:0,type:"success"},{default:t(()=>[...e[20]||(e[20]=[s("正常",-1)])]),_:1})):a.status===0?(u(),m(U,{key:1,type:"warning"},{default:t(()=>[...e[21]||(e[21]=[s("待审核",-1)])]),_:1})):(u(),m(U,{key:2,type:"danger"},{default:t(()=>[...e[22]||(e[22]=[s("禁用",-1)])]),_:1}))]),_:1}),l(f,{prop:"createTime",label:"创建时间",width:"180"}),l(f,{label:"操作",width:"300",fixed:"right"},{default:t(({row:a})=>[l(v,{link:"",type:"primary",onClick:I=>K(a)},{default:t(()=>[...e[23]||(e[23]=[s("编辑",-1)])]),_:1},8,["onClick"]),l(v,{link:"",type:"primary",onClick:I=>G(a)},{default:t(()=>[s(de(a.status===1?"禁用":"启用"),1)]),_:2},1032,["onClick"]),l(W,{style:{"margin-left":"10px"}},{dropdown:t(()=>[l(Q,null,{default:t(()=>[a.role!=="ADMIN"?(u(),m(E,{key:0,onClick:I=>h(a,"ADMIN")},{default:t(()=>[...e[25]||(e[25]=[s("设为管理员",-1)])]),_:1},8,["onClick"])):x("",!0),a.role!=="SUPPLIER"?(u(),m(E,{key:1,onClick:I=>h(a,"SUPPLIER")},{default:t(()=>[...e[26]||(e[26]=[s("设为供应商",-1)])]),_:1},8,["onClick"])):x("",!0),l(E,{onClick:I=>H(a.id)},{default:t(()=>[...e[27]||(e[27]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:t(()=>[l(v,{link:"",type:"primary"},{default:t(()=>[e[24]||(e[24]=s(" 更多操作",-1)),l(J,{class:"el-icon--right"},{default:t(()=>[l(ie(pe))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ae,N.value]]),l(Y,{"current-page":g.page,"onUpdate:currentPage":e[3]||(e[3]=a=>g.page=a),"page-size":g.size,"onUpdate:pageSize":e[4]||(e[4]=a=>g.size=a),total:g.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:y,onCurrentChange:y,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),l(le,{modelValue:V.value,"onUpdate:modelValue":e[14]||(e[14]=a=>V.value=a),title:P.value,width:"500px"},{footer:t(()=>[l(v,{onClick:e[13]||(e[13]=a=>V.value=!1)},{default:t(()=>[...e[28]||(e[28]=[s("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:O,loading:S.value},{default:t(()=>[...e[29]||(e[29]=[s("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(ee,{ref_key:"formRef",ref:C,model:r,rules:A,"label-width":"100px"},{default:t(()=>[l(b,{label:"用户名",prop:"username"},{default:t(()=>[l(c,{modelValue:r.username,"onUpdate:modelValue":e[5]||(e[5]=a=>r.username=a),disabled:w.value,placeholder:"请输入用户名"},null,8,["modelValue","disabled"])]),_:1}),w.value?x("",!0):(u(),m(b,{key:0,label:"密码",prop:"password"},{default:t(()=>[l(c,{modelValue:r.password,"onUpdate:modelValue":e[6]||(e[6]=a=>r.password=a),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),l(b,{label:"真实姓名",prop:"realName"},{default:t(()=>[l(c,{modelValue:r.realName,"onUpdate:modelValue":e[7]||(e[7]=a=>r.realName=a),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),l(b,{label:"手机号",prop:"phone"},{default:t(()=>[l(c,{modelValue:r.phone,"onUpdate:modelValue":e[8]||(e[8]=a=>r.phone=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(b,{label:"邮箱",prop:"email"},{default:t(()=>[l(c,{modelValue:r.email,"onUpdate:modelValue":e[9]||(e[9]=a=>r.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(b,{label:"角色",prop:"role"},{default:t(()=>[l(k,{modelValue:r.role,"onUpdate:modelValue":e[10]||(e[10]=a=>r.role=a),placeholder:"请选择角色",style:{width:"100%"}},{default:t(()=>[l(i,{label:"管理员",value:"ADMIN"}),l(i,{label:"供应商",value:"SUPPLIER"})]),_:1},8,["modelValue"])]),_:1}),r.role==="SUPPLIER"?(u(),m(b,{key:1,label:"关联供应商",prop:"supplierId"},{default:t(()=>[l(k,{modelValue:r.supplierId,"onUpdate:modelValue":e[11]||(e[11]=a=>r.supplierId=a),placeholder:"请选择供应商",style:{width:"100%"}},{default:t(()=>[(u(!0),B(me,null,fe(z.value,a=>(u(),m(i,{key:a.id,label:a.companyName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):x("",!0),l(b,{label:"状态",prop:"status"},{default:t(()=>[l(k,{modelValue:r.status,"onUpdate:modelValue":e[12]||(e[12]=a=>r.status=a),placeholder:"请选择状态",style:{width:"100%"}},{default:t(()=>[l(i,{label:"待审核",value:0}),l(i,{label:"正常",value:1}),l(i,{label:"禁用",value:2})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Se=te(Ue,[["__scopeId","data-v-5cbf9184"]]);export{Se as default};
