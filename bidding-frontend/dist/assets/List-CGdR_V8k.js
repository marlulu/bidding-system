import{_ as P,u as R,r as w,b as x,s as j,k as z,o as l,g as o,w as a,e as p,f as I,G as O,h as Y,D as G,d as r,m as g,j as s,i as N,F as H,K as B,E as T}from"./index-Dg0MfX17.js";import{g as K,p as q,d as J}from"./notice-CKDF6Ln0.js";const Q={class:"page-container"},W={class:"search-bar"},X={__name:"List",setup(Z){const f=I(),C=R(),k=w(!1),v=w([]),m=x({keyword:""}),i=x({page:1,size:10,total:0}),u=async()=>{k.value=!0;try{const n=await K({page:i.page,size:i.size,keyword:m.keyword});v.value=n.records,i.total=n.total}catch(n){console.error("加载数据失败",n)}finally{k.value=!1}},b=()=>{i.page=1,u()},D=()=>{m.keyword="",b()},E=()=>{f.push("/notices/create")},h=n=>{f.push(`/notices/detail/${n}`)},S=n=>{f.push(`/notices/edit/${n}`)},V=async n=>{try{await B.confirm("确认发布该通知吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await q(n),T.success("发布成功"),u()}catch(e){e!=="cancel"&&console.error("发布失败",e)}},U=async n=>{try{await B.confirm("确认删除该通知吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await J(n),T.success("删除成功"),u()}catch(e){e!=="cancel"&&console.error("删除失败",e)}};return j(()=>{u()}),(n,e)=>{const $=p("el-input"),d=p("el-button"),c=p("el-table-column"),y=p("el-tag"),A=p("el-table"),F=p("el-pagination"),L=p("el-card"),M=O("loading");return l(),z("div",Q,[o(L,null,{default:a(()=>[Y("div",W,[o($,{modelValue:m.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>m.keyword=t),placeholder:"搜索标题、内容",style:{width:"300px","margin-right":"10px"},clearable:""},null,8,["modelValue"]),o(d,{type:"primary",onClick:b},{default:a(()=>[...e[3]||(e[3]=[s("搜索",-1)])]),_:1}),o(d,{onClick:D},{default:a(()=>[...e[4]||(e[4]=[s("重置",-1)])]),_:1}),N(C).isAdmin()?(l(),r(d,{key:0,type:"success",onClick:E,style:{float:"right"}},{default:a(()=>[...e[5]||(e[5]=[s(" 新建通知 ",-1)])]),_:1})):g("",!0)]),G((l(),r(A,{data:v.value,style:{width:"100%","margin-top":"20px"}},{default:a(()=>[o(c,{prop:"title",label:"标题","min-width":"300"}),o(c,{prop:"type",label:"类型",width:"120"},{default:a(({row:t})=>[t.type==="SYSTEM"?(l(),r(y,{key:0},{default:a(()=>[...e[6]||(e[6]=[s("系统通知",-1)])]),_:1})):t.type==="POLICY"?(l(),r(y,{key:1,type:"warning"},{default:a(()=>[...e[7]||(e[7]=[s("政策变动",-1)])]),_:1})):t.type==="ANNOUNCEMENT"?(l(),r(y,{key:2,type:"success"},{default:a(()=>[...e[8]||(e[8]=[s("公告提醒",-1)])]),_:1})):g("",!0)]),_:1}),o(c,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[t.status==="DRAFT"?(l(),r(y,{key:0,type:"info"},{default:a(()=>[...e[9]||(e[9]=[s("草稿",-1)])]),_:1})):t.status==="PUBLISHED"?(l(),r(y,{key:1,type:"success"},{default:a(()=>[...e[10]||(e[10]=[s("已发布",-1)])]),_:1})):g("",!0)]),_:1}),o(c,{prop:"publishTime",label:"发布时间",width:"180"}),o(c,{label:"操作",width:"250",fixed:"right"},{default:a(({row:t})=>[o(d,{link:"",type:"primary",onClick:_=>h(t.id)},{default:a(()=>[...e[11]||(e[11]=[s("查看",-1)])]),_:1},8,["onClick"]),N(C).isAdmin()?(l(),z(H,{key:0},[o(d,{link:"",type:"primary",onClick:_=>S(t.id)},{default:a(()=>[...e[12]||(e[12]=[s("编辑",-1)])]),_:1},8,["onClick"]),t.status==="DRAFT"?(l(),r(d,{key:0,link:"",type:"success",onClick:_=>V(t.id)},{default:a(()=>[...e[13]||(e[13]=[s(" 发布 ",-1)])]),_:1},8,["onClick"])):g("",!0),o(d,{link:"",type:"danger",onClick:_=>U(t.id)},{default:a(()=>[...e[14]||(e[14]=[s("删除",-1)])]),_:1},8,["onClick"])],64)):g("",!0)]),_:1})]),_:1},8,["data"])),[[M,k.value]]),o(F,{"current-page":i.page,"onUpdate:currentPage":e[1]||(e[1]=t=>i.page=t),"page-size":i.size,"onUpdate:pageSize":e[2]||(e[2]=t=>i.size=t),total:i.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:u,onCurrentChange:u,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1})])}}},ae=P(X,[["__scopeId","data-v-e03d8d4a"]]);export{ae as default};
