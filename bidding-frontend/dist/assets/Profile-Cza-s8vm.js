import{L as oe,_ as ye,u as ke,r as g,a as Pe,b as q,M as Ve,N as A,s as Ie,k as N,o as d,g as e,w as t,e as r,E as p,f as he,G as Ne,h as c,i as f,t as R,j as v,d as x,m as y,O as xe,P as Ce,Q as Ue,R as De,S as Se,D as le,K as Ae}from"./index-Dg0MfX17.js";import{u as Re,c as Te}from"./user-hoTlkoqH.js";import{a as Fe}from"./announcement-BREv7e2N.js";import{a as Be}from"./supplier-Brz4Qjp8.js";function qe(D){return oe({url:"/favorites",method:"get",params:D})}function Me(D,s){return oe({url:"/favorites",method:"delete",params:{targetId:D,targetType:s}})}const je={class:"profile container"},ze={class:"user-brief"},Ee={key:0},Ge=["src"],$e={key:1},Le={key:2},Oe={key:3},Je={__name:"Profile",setup(D){var $,L,O,J,H,K;const s=ke(),M=Pe(),j=he(),w=g(M.query.tab||"info"),k=g("announcement"),z=g(null),E=g(null),n=q({id:($=s.userInfo)==null?void 0:$.id,username:((L=s.userInfo)==null?void 0:L.username)||"",realName:((O=s.userInfo)==null?void 0:O.realName)||"",phone:((J=s.userInfo)==null?void 0:J.phone)||"",email:((H=s.userInfo)==null?void 0:H.email)||"",avatar:((K=s.userInfo)==null?void 0:K.avatar)||""}),_=q({oldPassword:"",newPassword:"",confirmPassword:""}),se=q({Authorization:"Bearer "+Ve()}),re={realName:[{required:!0,message:"真实姓名不能为空",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},ne={oldPassword:[{required:!0,message:"旧密码不能为空",trigger:"blur"}],newPassword:[{required:!0,message:"新密码不能为空",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(l,a,u)=>{a!==_.newPassword?u(new Error("两次输入密码不一致!")):u()},trigger:"blur"}]},ue=g([{projectName:"2026年度企业数字化转型软件采购项目",bidAmount:48e5,status:"已提交",createTime:"2026-01-08"}]),T=g([]),F=g([]),P=g(!1),de=l=>{w.value=l},ie=l=>{l.code===200?(n.avatar=l.data,s.setUserInfo({...s.userInfo,avatar:l.data}),p.success("头像上传成功")):p.error("头像上传失败: "+(l.message||"未知错误"))},pe=l=>{const a=l.type==="image/jpeg"||l.type==="image/png",u=l.size/1024/1024<2;return a||p.error("上传头像图片只能是 JPG/PNG 格式!"),u||p.error("上传头像图片大小不能超过 2MB!"),a&&u},me=async()=>{try{await z.value.validate(),await Re(n.id,n),s.setUserInfo({...s.userInfo,...n}),p.success("个人信息更新成功")}catch(l){console.error("更新个人信息失败",l),p.error("更新个人信息失败: "+(l.message||"未知错误"))}},ce=async()=>{try{await E.value.validate(),await Te(_),p.success("密码修改成功，请重新登录"),s.logout()}catch(l){console.error("修改密码失败",l),p.error("修改密码失败: "+(l.message||"未知错误"))}};A(()=>M.query.tab,l=>{w.value=l||"info"},{immediate:!0}),A(()=>s.userInfo,l=>{l&&Object.assign(n,l)},{immediate:!0,deep:!0});const C=async()=>{P.value=!0;try{const l=await qe({page:1,size:100,targetType:k.value.toUpperCase()});if(k.value==="announcement"){const a=await Promise.all(l.records.map(async u=>{const V=await Fe(u.targetId);return{...u,...V}}));T.value=a}else if(k.value==="supplier"){const a=await Promise.all(l.records.map(async u=>{const V=await Be(u.targetId);return{...u,...V}}));F.value=a}}catch(l){console.error("加载收藏列表失败",l),p.error("加载收藏列表失败")}finally{P.value=!1}},G=async l=>{try{await Ae.confirm("确认取消收藏吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Me(l),p.success("取消收藏成功"),C()}catch(a){a!=="cancel"&&(console.error("取消收藏失败",a),p.error("取消收藏失败"))}},fe=l=>{j.push({name:"AnnouncementDetail",params:{id:l}})},_e=l=>{j.push({name:"SupplierDetail",params:{id:l}})};return Ie(()=>{Object.assign(n,s.userInfo),C()}),A(w,l=>{l==="favorites"&&C()}),A(k,()=>{C()}),(l,a)=>{const u=r("el-avatar"),V=r("el-tag"),U=r("el-icon"),S=r("el-menu-item"),ve=r("el-menu"),Q=r("el-card"),W=r("el-col"),we=r("el-upload"),m=r("el-form-item"),b=r("el-input"),I=r("el-button"),X=r("el-form"),i=r("el-table-column"),B=r("el-table"),Y=r("el-empty"),Z=r("el-tab-pane"),ge=r("el-tabs"),be=r("el-row"),ee=Ne("loading");return d(),N("div",je,[e(be,{gutter:30},{default:t(()=>[e(W,{span:6},{default:t(()=>[e(Q,{class:"menu-card",shadow:"never"},{default:t(()=>{var o,h,ae;return[c("div",ze,[e(u,{size:80,src:((o=f(s).userInfo)==null?void 0:o.avatar)||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"},null,8,["src"]),c("h3",null,R(((h=f(s).userInfo)==null?void 0:h.realName)||((ae=f(s).userInfo)==null?void 0:ae.username)),1),e(V,{size:"small"},{default:t(()=>{var te;return[v(R(((te=f(s).userInfo)==null?void 0:te.role)==="ADMIN"?"系统管理员":"认证供应商"),1)]}),_:1})]),e(ve,{"default-active":w.value,class:"profile-menu",onSelect:de},{default:t(()=>[e(S,{index:"info"},{default:t(()=>[e(U,null,{default:t(()=>[e(f(xe))]),_:1}),a[8]||(a[8]=c("span",null,"个人资料",-1))]),_:1}),e(S,{index:"favorites"},{default:t(()=>[e(U,null,{default:t(()=>[e(f(Ce))]),_:1}),a[9]||(a[9]=c("span",null,"我的收藏",-1))]),_:1}),f(s).isSupplier()?(d(),x(S,{key:0,index:"bids"},{default:t(()=>[e(U,null,{default:t(()=>[e(f(Ue))]),_:1}),a[10]||(a[10]=c("span",null,"投标记录",-1))]),_:1})):y("",!0),e(S,{index:"security"},{default:t(()=>[e(U,null,{default:t(()=>[e(f(De))]),_:1}),a[11]||(a[11]=c("span",null,"安全设置",-1))]),_:1})]),_:1},8,["default-active"])]}),_:1})]),_:1}),e(W,{span:18},{default:t(()=>[e(Q,{class:"content-card",shadow:"never"},{default:t(()=>[w.value==="info"?(d(),N("div",Ee,[a[13]||(a[13]=c("h2",{class:"section-title"},"个人资料",-1)),e(X,{ref_key:"userFormRef",ref:z,model:n,rules:re,"label-width":"100px",style:{"max-width":"500px"}},{default:t(()=>[e(m,{label:"头像"},{default:t(()=>[e(we,{class:"avatar-uploader",action:"/api/files/upload",headers:se,"show-file-list":!1,"on-success":ie,"before-upload":pe},{default:t(()=>[n.avatar?(d(),N("img",{key:0,src:n.avatar,class:"avatar"},null,8,Ge)):(d(),x(U,{key:1,class:"avatar-uploader-icon"},{default:t(()=>[e(f(Se))]),_:1}))]),_:1},8,["headers"])]),_:1}),e(m,{label:"用户名"},{default:t(()=>[e(b,{modelValue:n.username,"onUpdate:modelValue":a[0]||(a[0]=o=>n.username=o),disabled:""},null,8,["modelValue"])]),_:1}),e(m,{label:"真实姓名",prop:"realName"},{default:t(()=>[e(b,{modelValue:n.realName,"onUpdate:modelValue":a[1]||(a[1]=o=>n.realName=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"手机号",prop:"phone"},{default:t(()=>[e(b,{modelValue:n.phone,"onUpdate:modelValue":a[2]||(a[2]=o=>n.phone=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"邮箱",prop:"email"},{default:t(()=>[e(b,{modelValue:n.email,"onUpdate:modelValue":a[3]||(a[3]=o=>n.email=o)},null,8,["modelValue"])]),_:1}),e(m,null,{default:t(()=>[e(I,{type:"primary",onClick:me},{default:t(()=>[...a[12]||(a[12]=[v("保存修改",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])):y("",!0),w.value==="favorites"?(d(),N("div",$e,[a[18]||(a[18]=c("h2",{class:"section-title"},"我的收藏",-1)),e(ge,{modelValue:k.value,"onUpdate:modelValue":a[4]||(a[4]=o=>k.value=o),onTabChange:C},{default:t(()=>[e(Z,{label:"招标公告",name:"announcement"},{default:t(()=>[le((d(),x(B,{data:T.value,style:{width:"100%"}},{default:t(()=>[e(i,{prop:"title",label:"公告标题"}),e(i,{prop:"publishTime",label:"发布时间",width:"180"}),e(i,{label:"操作",width:"150"},{default:t(({row:o})=>[e(I,{link:"",type:"primary",onClick:h=>fe(o.targetId)},{default:t(()=>[...a[14]||(a[14]=[v("查看",-1)])]),_:1},8,["onClick"]),e(I,{link:"",type:"danger",onClick:h=>G(o.id)},{default:t(()=>[...a[15]||(a[15]=[v("取消收藏",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,P.value]]),T.value.length===0&&!P.value?(d(),x(Y,{key:0,description:"暂无收藏的公告"})):y("",!0)]),_:1}),e(Z,{label:"供应商",name:"supplier"},{default:t(()=>[le((d(),x(B,{data:F.value,style:{width:"100%"}},{default:t(()=>[e(i,{prop:"companyName",label:"公司名称"}),e(i,{prop:"contactName",label:"联系人",width:"120"}),e(i,{prop:"contactPhone",label:"联系电话",width:"150"}),e(i,{label:"操作",width:"150"},{default:t(({row:o})=>[e(I,{link:"",type:"primary",onClick:h=>_e(o.targetId)},{default:t(()=>[...a[16]||(a[16]=[v("查看",-1)])]),_:1},8,["onClick"]),e(I,{link:"",type:"danger",onClick:h=>G(o.id)},{default:t(()=>[...a[17]||(a[17]=[v("取消收藏",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,P.value]]),F.value.length===0&&!P.value?(d(),x(Y,{key:0,description:"暂无收藏的供应商"})):y("",!0)]),_:1})]),_:1},8,["modelValue"])])):y("",!0),w.value==="bids"?(d(),N("div",Le,[a[19]||(a[19]=c("h2",{class:"section-title"},"投标记录",-1)),e(B,{data:ue.value,style:{width:"100%"}},{default:t(()=>[e(i,{prop:"projectName",label:"项目名称"}),e(i,{prop:"bidAmount",label:"投标金额"},{default:t(({row:o})=>[v("￥"+R(o.bidAmount.toLocaleString()),1)]),_:1}),e(i,{prop:"status",label:"状态"},{default:t(({row:o})=>[e(V,{type:o.status==="WIN"?"success":"info"},{default:t(()=>[v(R(o.status),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"createTime",label:"投标时间"})]),_:1},8,["data"])])):y("",!0),w.value==="security"?(d(),N("div",Oe,[a[21]||(a[21]=c("h2",{class:"section-title"},"安全设置",-1)),e(X,{ref_key:"passwordFormRef",ref:E,model:_,rules:ne,"label-width":"100px",style:{"max-width":"500px"}},{default:t(()=>[e(m,{label:"旧密码",prop:"oldPassword"},{default:t(()=>[e(b,{modelValue:_.oldPassword,"onUpdate:modelValue":a[5]||(a[5]=o=>_.oldPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(m,{label:"新密码",prop:"newPassword"},{default:t(()=>[e(b,{modelValue:_.newPassword,"onUpdate:modelValue":a[6]||(a[6]=o=>_.newPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(m,{label:"确认新密码",prop:"confirmPassword"},{default:t(()=>[e(b,{modelValue:_.confirmPassword,"onUpdate:modelValue":a[7]||(a[7]=o=>_.confirmPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(m,null,{default:t(()=>[e(I,{type:"primary",onClick:ce},{default:t(()=>[...a[20]||(a[20]=[v("修改密码",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])):y("",!0)]),_:1})]),_:1})]),_:1})])}}},Xe=ye(Je,[["__scopeId","data-v-9d389627"]]);export{Xe as default};
