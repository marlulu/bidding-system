import{_ as I,r as h,a as z,k as j,c as N,o as l,d as a,w as n,e as d,u as q,G as O,b as Y,D as G,l as r,q as f,g as s,m as B,F as H,J as T,E as D}from"./index-8BbQxS2W.js";import{u as J}from"./user-CoC7bmMY.js";import{r as b}from"./request-BHOxzfOV.js";function K(p){return b({url:"/notices",method:"get",params:p})}function Q(p){return b({url:`/notices/${p}`,method:"delete"})}function W(p){return b({url:`/notices/${p}/publish`,method:"put"})}const X={class:"page-container"},Z={class:"search-bar"},ee={__name:"List",setup(p){const k=q(),v=J(),_=h(!1),w=h([]),g=z({keyword:""}),i=z({page:1,size:10,total:0}),c=async()=>{_.value=!0;try{const o=await K({page:i.page,size:i.size,keyword:g.keyword});w.value=o.records,i.total=o.total}catch(o){console.error("加载数据失败",o)}finally{_.value=!1}},x=()=>{i.page=1,c()},E=()=>{g.keyword="",x()},S=()=>{k.push("/notices/create")},V=o=>{k.push(`/notices/detail/${o}`)},$=o=>{k.push(`/notices/edit/${o}`)},U=async o=>{try{await T.confirm("确认发布该通知吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await W(o),D.success("发布成功"),c()}catch(e){e!=="cancel"&&console.error("发布失败",e)}},A=async o=>{try{await T.confirm("确认删除该通知吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Q(o),D.success("删除成功"),c()}catch(e){e!=="cancel"&&console.error("删除失败",e)}};return j(()=>{c()}),(o,e)=>{const F=d("el-input"),u=d("el-button"),y=d("el-table-column"),m=d("el-tag"),L=d("el-table"),M=d("el-pagination"),P=d("el-card"),R=O("loading");return l(),N("div",X,[a(P,null,{default:n(()=>[Y("div",Z,[a(F,{modelValue:g.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>g.keyword=t),placeholder:"搜索标题、内容",style:{width:"300px","margin-right":"10px"},clearable:""},null,8,["modelValue"]),a(u,{type:"primary",onClick:x},{default:n(()=>[...e[3]||(e[3]=[s("搜索",-1)])]),_:1}),a(u,{onClick:E},{default:n(()=>[...e[4]||(e[4]=[s("重置",-1)])]),_:1}),B(v).isAdmin()?(l(),r(u,{key:0,type:"success",onClick:S,style:{float:"right"}},{default:n(()=>[...e[5]||(e[5]=[s(" 新建通知 ",-1)])]),_:1})):f("",!0)]),G((l(),r(L,{data:w.value,style:{width:"100%","margin-top":"20px"}},{default:n(()=>[a(y,{prop:"title",label:"标题","min-width":"300"}),a(y,{prop:"type",label:"类型",width:"120"},{default:n(({row:t})=>[t.type==="SYSTEM"?(l(),r(m,{key:0},{default:n(()=>[...e[6]||(e[6]=[s("系统通知",-1)])]),_:1})):t.type==="POLICY"?(l(),r(m,{key:1,type:"warning"},{default:n(()=>[...e[7]||(e[7]=[s("政策变动",-1)])]),_:1})):t.type==="ANNOUNCEMENT"?(l(),r(m,{key:2,type:"success"},{default:n(()=>[...e[8]||(e[8]=[s("公告提醒",-1)])]),_:1})):f("",!0)]),_:1}),a(y,{prop:"status",label:"状态",width:"100"},{default:n(({row:t})=>[t.status==="DRAFT"?(l(),r(m,{key:0,type:"info"},{default:n(()=>[...e[9]||(e[9]=[s("草稿",-1)])]),_:1})):t.status==="PUBLISHED"?(l(),r(m,{key:1,type:"success"},{default:n(()=>[...e[10]||(e[10]=[s("已发布",-1)])]),_:1})):f("",!0)]),_:1}),a(y,{prop:"publishTime",label:"发布时间",width:"180"}),a(y,{label:"操作",width:"250",fixed:"right"},{default:n(({row:t})=>[a(u,{link:"",type:"primary",onClick:C=>V(t.id)},{default:n(()=>[...e[11]||(e[11]=[s("查看",-1)])]),_:1},8,["onClick"]),B(v).isAdmin()?(l(),N(H,{key:0},[a(u,{link:"",type:"primary",onClick:C=>$(t.id)},{default:n(()=>[...e[12]||(e[12]=[s("编辑",-1)])]),_:1},8,["onClick"]),t.status==="DRAFT"?(l(),r(u,{key:0,link:"",type:"success",onClick:C=>U(t.id)},{default:n(()=>[...e[13]||(e[13]=[s(" 发布 ",-1)])]),_:1},8,["onClick"])):f("",!0),a(u,{link:"",type:"danger",onClick:C=>A(t.id)},{default:n(()=>[...e[14]||(e[14]=[s("删除",-1)])]),_:1},8,["onClick"])],64)):f("",!0)]),_:1})]),_:1},8,["data"])),[[R,_.value]]),a(M,{"current-page":i.page,"onUpdate:currentPage":e[1]||(e[1]=t=>i.page=t),"page-size":i.size,"onUpdate:pageSize":e[2]||(e[2]=t=>i.size=t),total:i.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c,onCurrentChange:c,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1})])}}},ae=I(ee,[["__scopeId","data-v-e03d8d4a"]]);export{ae as default};
