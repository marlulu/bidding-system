import{_ as N,r as w,a as x,o as R,l as z,d as s,h as n,e as a,f as p,g as j,G,i as M,D as O,b as r,n as g,k as l,j as B,F as H,J as D,E as T}from"./index-DCFAUsYj.js";import{u as J}from"./user-D1_W61zT.js";import{g as Y,p as q,d as K}from"./policy-C_SS_x5p.js";import"./request--6APTGSy.js";const Q={class:"page-container"},W={class:"search-bar"},X={__name:"List",setup(Z){const f=j(),v=J(),k=w(!1),C=w([]),m=x({keyword:""}),i=x({page:1,size:10,total:0}),u=async()=>{k.value=!0;try{const o=await Y({page:i.page,size:i.size,keyword:m.keyword});C.value=o.records,i.total=o.total}catch(o){console.error("加载数据失败",o)}finally{k.value=!1}},b=()=>{i.page=1,u()},h=()=>{m.keyword="",b()},E=()=>{f.push("/policies/create")},V=o=>{f.push(`/policies/detail/${o}`)},P=o=>{f.push(`/policies/edit/${o}`)},U=async o=>{try{await D.confirm("确认发布该政策法规吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await q(o),T.success("发布成功"),u()}catch(e){e!=="cancel"&&console.error("发布失败",e)}},L=async o=>{try{await D.confirm("确认删除该政策法规吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await K(o),T.success("删除成功"),u()}catch(e){e!=="cancel"&&console.error("删除失败",e)}};return R(()=>{u()}),(o,e)=>{const S=p("el-input"),d=p("el-button"),c=p("el-table-column"),y=p("el-tag"),$=p("el-table"),A=p("el-pagination"),F=p("el-card"),I=G("loading");return s(),z("div",Q,[n(F,null,{default:a(()=>[M("div",W,[n(S,{modelValue:m.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>m.keyword=t),placeholder:"搜索标题",style:{width:"300px","margin-right":"10px"},clearable:""},null,8,["modelValue"]),n(d,{type:"primary",onClick:b},{default:a(()=>[...e[3]||(e[3]=[l("搜索",-1)])]),_:1}),n(d,{onClick:h},{default:a(()=>[...e[4]||(e[4]=[l("重置",-1)])]),_:1}),B(v).isAdmin()?(s(),r(d,{key:0,type:"success",onClick:E,style:{float:"right"}},{default:a(()=>[...e[5]||(e[5]=[l(" 新建政策法规 ",-1)])]),_:1})):g("",!0)]),O((s(),r($,{data:C.value,style:{width:"100%","margin-top":"20px"}},{default:a(()=>[n(c,{prop:"title",label:"标题","min-width":"300"}),n(c,{prop:"category",label:"分类",width:"120"},{default:a(({row:t})=>[t.category==="POLICY"?(s(),r(y,{key:0},{default:a(()=>[...e[6]||(e[6]=[l("政策",-1)])]),_:1})):t.category==="REGULATION"?(s(),r(y,{key:1,type:"warning"},{default:a(()=>[...e[7]||(e[7]=[l("法规",-1)])]),_:1})):t.category==="GUIDE"?(s(),r(y,{key:2,type:"success"},{default:a(()=>[...e[8]||(e[8]=[l("指南",-1)])]),_:1})):g("",!0)]),_:1}),n(c,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[t.status==="DRAFT"?(s(),r(y,{key:0,type:"info"},{default:a(()=>[...e[9]||(e[9]=[l("草稿",-1)])]),_:1})):t.status==="PUBLISHED"?(s(),r(y,{key:1,type:"success"},{default:a(()=>[...e[10]||(e[10]=[l("已发布",-1)])]),_:1})):g("",!0)]),_:1}),n(c,{prop:"publishTime",label:"发布时间",width:"180"}),n(c,{label:"操作",width:"250",fixed:"right"},{default:a(({row:t})=>[n(d,{link:"",type:"primary",onClick:_=>V(t.id)},{default:a(()=>[...e[11]||(e[11]=[l("查看",-1)])]),_:1},8,["onClick"]),B(v).isAdmin()?(s(),z(H,{key:0},[n(d,{link:"",type:"primary",onClick:_=>P(t.id)},{default:a(()=>[...e[12]||(e[12]=[l("编辑",-1)])]),_:1},8,["onClick"]),t.status==="DRAFT"?(s(),r(d,{key:0,link:"",type:"success",onClick:_=>U(t.id)},{default:a(()=>[...e[13]||(e[13]=[l(" 发布 ",-1)])]),_:1},8,["onClick"])):g("",!0),n(d,{link:"",type:"danger",onClick:_=>L(t.id)},{default:a(()=>[...e[14]||(e[14]=[l("删除",-1)])]),_:1},8,["onClick"])],64)):g("",!0)]),_:1})]),_:1},8,["data"])),[[I,k.value]]),n(A,{"current-page":i.page,"onUpdate:currentPage":e[1]||(e[1]=t=>i.page=t),"page-size":i.size,"onUpdate:pageSize":e[2]||(e[2]=t=>i.size=t),total:i.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:u,onCurrentChange:u,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1})])}}},ne=N(X,[["__scopeId","data-v-1896cc63"]]);export{ne as default};
