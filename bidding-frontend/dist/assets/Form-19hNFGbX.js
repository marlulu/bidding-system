import{_ as T,r as f,c as x,a as A,b as q,s as M,k as S,g as e,w as a,e as u,f as F,o as i,d as N,m as Y,j as p,F as H,v as O,h as J,t as G,E as U}from"./index-BL-C57Wi.js";import{a as z,u as K,c as Q}from"./announcement-D6_FGflW.js";import{b as W}from"./supplier-7zuO87Cs.js";const X={class:"page-container"},Z={__name:"Form",setup($){const m=A(),v=F(),_=f(null),c=f(!1),V=f([]),b=x(()=>!!m.params.id),t=q({announcementNo:"",title:"",type:"BID",projectName:"",projectBudget:0,bidDeadline:"",contactPerson:"",contactPhone:"",visibilityLevel:"PUBLIC",visibleSupplierIds:[],content:""}),B={announcementNo:[{required:!0,message:"请输入公告编号",trigger:"blur"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],type:[{required:!0,message:"请选择公告类型",trigger:"change"}],projectName:[{required:!0,message:"请输入项目名称",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}]},D=async()=>{try{V.value=await W()}catch(n){console.error("加载供应商列表失败",n)}},k=async()=>{if(b.value)try{const n=await z(m.params.id);Object.assign(t,n),n.visibleSupplierIds&&(t.visibleSupplierIds=JSON.parse(n.visibleSupplierIds))}catch(n){console.error("加载数据失败",n)}},E=async()=>{try{await _.value.validate(),c.value=!0;const n={...t};n.visibleSupplierIds&&n.visibleSupplierIds.length>0?n.visibleSupplierIds=JSON.stringify(n.visibleSupplierIds):n.visibleSupplierIds=null,b.value?(await K(m.params.id,n),U.success("更新成功")):(await Q(n),U.success("创建成功")),v.push("/announcements")}catch(n){console.error("提交失败",n)}finally{c.value=!1}},j=()=>{v.back()};return M(()=>{D(),k()}),(n,l)=>{const s=u("el-input"),r=u("el-form-item"),d=u("el-option"),g=u("el-select"),C=u("el-input-number"),w=u("el-date-picker"),y=u("el-radio"),P=u("el-radio-group"),I=u("el-button"),R=u("el-form"),L=u("el-card");return i(),S("div",X,[e(L,null,{header:a(()=>[J("span",null,G(b.value?"编辑招标公告":"新建招标公告"),1)]),default:a(()=>[e(R,{ref_key:"formRef",ref:_,model:t,rules:B,"label-width":"120px"},{default:a(()=>[e(r,{label:"公告编号",prop:"announcementNo"},{default:a(()=>[e(s,{modelValue:t.announcementNo,"onUpdate:modelValue":l[0]||(l[0]=o=>t.announcementNo=o),placeholder:"请输入公告编号"},null,8,["modelValue"])]),_:1}),e(r,{label:"标题",prop:"title"},{default:a(()=>[e(s,{modelValue:t.title,"onUpdate:modelValue":l[1]||(l[1]=o=>t.title=o),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),e(r,{label:"公告类型",prop:"type"},{default:a(()=>[e(g,{modelValue:t.type,"onUpdate:modelValue":l[2]||(l[2]=o=>t.type=o),placeholder:"请选择公告类型"},{default:a(()=>[e(d,{label:"招标公告",value:"BID"}),e(d,{label:"变更公告",value:"CHANGE"}),e(d,{label:"终止公告",value:"TERMINATE"}),e(d,{label:"中标结果",value:"RESULT"})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"项目名称",prop:"projectName"},{default:a(()=>[e(s,{modelValue:t.projectName,"onUpdate:modelValue":l[3]||(l[3]=o=>t.projectName=o),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),e(r,{label:"项目预算",prop:"projectBudget"},{default:a(()=>[e(C,{modelValue:t.projectBudget,"onUpdate:modelValue":l[4]||(l[4]=o=>t.projectBudget=o),min:0,precision:2},null,8,["modelValue"])]),_:1}),e(r,{label:"投标截止时间",prop:"bidDeadline"},{default:a(()=>[e(w,{modelValue:t.bidDeadline,"onUpdate:modelValue":l[5]||(l[5]=o=>t.bidDeadline=o),type:"datetime",placeholder:"选择日期时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(r,{label:"联系人",prop:"contactPerson"},{default:a(()=>[e(s,{modelValue:t.contactPerson,"onUpdate:modelValue":l[6]||(l[6]=o=>t.contactPerson=o),placeholder:"请输入联系人"},null,8,["modelValue"])]),_:1}),e(r,{label:"联系电话",prop:"contactPhone"},{default:a(()=>[e(s,{modelValue:t.contactPhone,"onUpdate:modelValue":l[7]||(l[7]=o=>t.contactPhone=o),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),e(r,{label:"可见级别",prop:"visibilityLevel"},{default:a(()=>[e(P,{modelValue:t.visibilityLevel,"onUpdate:modelValue":l[8]||(l[8]=o=>t.visibilityLevel=o)},{default:a(()=>[e(y,{label:"PUBLIC"},{default:a(()=>[...l[11]||(l[11]=[p("公开",-1)])]),_:1}),e(y,{label:"RESTRICTED"},{default:a(()=>[...l[12]||(l[12]=[p("受限",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t.visibilityLevel==="RESTRICTED"?(i(),N(r,{key:0,label:"可见供应商",prop:"visibleSupplierIds"},{default:a(()=>[e(g,{modelValue:t.visibleSupplierIds,"onUpdate:modelValue":l[9]||(l[9]=o=>t.visibleSupplierIds=o),multiple:"",placeholder:"请选择可见供应商",style:{width:"100%"}},{default:a(()=>[(i(!0),S(H,null,O(V.value,o=>(i(),N(d,{key:o.id,label:o.companyName,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):Y("",!0),e(r,{label:"内容",prop:"content"},{default:a(()=>[e(s,{modelValue:t.content,"onUpdate:modelValue":l[10]||(l[10]=o=>t.content=o),type:"textarea",rows:10,placeholder:"请输入公告内容"},null,8,["modelValue"])]),_:1}),e(r,null,{default:a(()=>[e(I,{type:"primary",onClick:E,loading:c.value},{default:a(()=>[...l[13]||(l[13]=[p("提交",-1)])]),_:1},8,["loading"]),e(I,{onClick:j},{default:a(()=>[...l[14]||(l[14]=[p("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},te=T(Z,[["__scopeId","data-v-84de881e"]]);export{te as default};
