import{_ as A,r as b,c as J,a as T,b as j,s as I,k as G,o as U,g as e,w as a,e as d,E as m,f as z,j as g,h as N,d as H,m as K,t as S}from"./index-Dg0MfX17.js";import{a as Q,u as W,c as X,e as Y}from"./supplier-Brz4Qjp8.js";const Z={class:"page-container"},$={class:"card-header"},ee={__name:"Form",setup(le){const v=T(),w=z(),q=b(null),V=b(!1),i=b([]),c=J(()=>!!v.params.id),t=j({companyName:"",companyCode:"",industry:"",scale:"SMALL",qualificationLevel:"",legalPerson:"",contactName:"",contactPhone:"",contactEmail:"",address:"",description:"",qualificationFiles:"[]",status:0}),C={companyName:[{required:!0,message:"请输入公司名称",trigger:"blur"}],companyCode:[{required:!0,message:"请输入统一社会信用代码",trigger:"blur"}],contactName:[{required:!0,message:"请输入联系人姓名",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入联系电话",trigger:"blur"}]},E=async()=>{if(c.value)try{const n=await Q(v.params.id);Object.assign(t,n),n.qualificationFiles&&(i.value=JSON.parse(n.qualificationFiles).map(l=>({name:l.name,url:l.url,response:{data:l.url}})))}catch(n){console.error("加载数据失败",n),m.error("加载供应商信息失败")}},L=async n=>{const l=n.file,f=new FormData;f.append("file",l);try{const s=await W(f),u={name:l.name,url:s};i.value.push(u),t.qualificationFiles=JSON.stringify(i.value.map(r=>({name:r.name,url:r.url}))),m.success("文件上传成功")}catch{m.error("文件上传失败")}},P=n=>{i.value=i.value.filter(l=>l.url!==n.url),t.qualificationFiles=JSON.stringify(i.value.map(l=>({name:l.name,url:l.url})))},k=()=>{m.warning("最多只能上传3个文件")},x=async()=>{try{await q.value.validate(),V.value=!0,c.value?(await X(v.params.id,t),m.success("更新成功")):(await Y(t),m.success("创建成功")),w.push("/suppliers")}catch(n){console.error("提交失败",n),m.error(n.message||"提交失败")}finally{V.value=!1}},h=()=>{w.back()},D=n=>({0:"待审核",1:"已认证",2:"已驳回"})[n]||"未知",M=n=>({0:"info",1:"success",2:"danger"})[n]||"info";return I(()=>{E()}),(n,l)=>{const f=d("el-tag"),s=d("el-input"),u=d("el-form-item"),r=d("el-col"),_=d("el-row"),p=d("el-option"),F=d("el-select"),y=d("el-button"),R=d("el-upload"),B=d("el-form"),O=d("el-card");return U(),G("div",Z,[e(O,null,{header:a(()=>[N("div",$,[N("span",null,S(c.value?"编辑供应商信息":"新增供应商"),1),c.value&&t.status!==void 0?(U(),H(f,{key:0,type:M(t.status)},{default:a(()=>[g(S(D(t.status)),1)]),_:1},8,["type"])):K("",!0)])]),default:a(()=>[e(B,{ref_key:"formRef",ref:q,model:t,rules:C,"label-width":"150px"},{default:a(()=>[e(_,{gutter:20},{default:a(()=>[e(r,{span:12},{default:a(()=>[e(u,{label:"公司名称",prop:"companyName"},{default:a(()=>[e(s,{modelValue:t.companyName,"onUpdate:modelValue":l[0]||(l[0]=o=>t.companyName=o),placeholder:"请输入公司名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{label:"统一社会信用代码",prop:"companyCode"},{default:a(()=>[e(s,{modelValue:t.companyCode,"onUpdate:modelValue":l[1]||(l[1]=o=>t.companyCode=o),placeholder:"请输入统一社会信用代码",disabled:c.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(_,{gutter:20},{default:a(()=>[e(r,{span:12},{default:a(()=>[e(u,{label:"所属行业",prop:"industry"},{default:a(()=>[e(F,{modelValue:t.industry,"onUpdate:modelValue":l[2]||(l[2]=o=>t.industry=o),placeholder:"请选择所属行业",style:{width:"100%"}},{default:a(()=>[e(p,{label:"信息技术",value:"信息技术"}),e(p,{label:"建筑工程",value:"建筑工程"}),e(p,{label:"医疗器械",value:"医疗器械"}),e(p,{label:"办公用品",value:"办公用品"}),e(p,{label:"咨询服务",value:"咨询服务"}),e(p,{label:"物流运输",value:"物流运输"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{label:"公司规模",prop:"scale"},{default:a(()=>[e(F,{modelValue:t.scale,"onUpdate:modelValue":l[3]||(l[3]=o=>t.scale=o),placeholder:"请选择公司规模",style:{width:"100%"}},{default:a(()=>[e(p,{label:"小型",value:"SMALL"}),e(p,{label:"中型",value:"MEDIUM"}),e(p,{label:"大型",value:"LARGE"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{gutter:20},{default:a(()=>[e(r,{span:12},{default:a(()=>[e(u,{label:"资质等级",prop:"qualificationLevel"},{default:a(()=>[e(s,{modelValue:t.qualificationLevel,"onUpdate:modelValue":l[4]||(l[4]=o=>t.qualificationLevel=o),placeholder:"请输入资质等级"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{label:"法人代表",prop:"legalPerson"},{default:a(()=>[e(s,{modelValue:t.legalPerson,"onUpdate:modelValue":l[5]||(l[5]=o=>t.legalPerson=o),placeholder:"请输入法人代表"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{gutter:20},{default:a(()=>[e(r,{span:8},{default:a(()=>[e(u,{label:"联系人",prop:"contactName"},{default:a(()=>[e(s,{modelValue:t.contactName,"onUpdate:modelValue":l[6]||(l[6]=o=>t.contactName=o),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:a(()=>[e(u,{label:"联系电话",prop:"contactPhone"},{default:a(()=>[e(s,{modelValue:t.contactPhone,"onUpdate:modelValue":l[7]||(l[7]=o=>t.contactPhone=o),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:a(()=>[e(u,{label:"联系邮箱",prop:"contactEmail"},{default:a(()=>[e(s,{modelValue:t.contactEmail,"onUpdate:modelValue":l[8]||(l[8]=o=>t.contactEmail=o),placeholder:"请输入联系邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,{label:"公司地址",prop:"address"},{default:a(()=>[e(s,{modelValue:t.address,"onUpdate:modelValue":l[9]||(l[9]=o=>t.address=o),placeholder:"请输入公司地址"},null,8,["modelValue"])]),_:1}),e(u,{label:"公司简介",prop:"description"},{default:a(()=>[e(s,{modelValue:t.description,"onUpdate:modelValue":l[10]||(l[10]=o=>t.description=o),type:"textarea",rows:4,placeholder:"请输入公司简介"},null,8,["modelValue"])]),_:1}),e(u,{label:"资质文件",prop:"qualificationFiles"},{default:a(()=>[e(R,{class:"upload-demo",action:"#","http-request":L,"on-remove":P,"file-list":i.value,limit:3,"on-exceed":k,multiple:"","auto-upload":!0},{tip:a(()=>[...l[12]||(l[12]=[N("div",{class:"el-upload__tip"},"支持上传图片、PDF等文件，单个文件不超过5MB",-1)])]),default:a(()=>[e(y,{type:"primary"},{default:a(()=>[...l[11]||(l[11]=[g("点击上传文件",-1)])]),_:1})]),_:1},8,["file-list"])]),_:1}),e(u,null,{default:a(()=>[e(y,{type:"primary",onClick:x,loading:V.value},{default:a(()=>[...l[13]||(l[13]=[g("提交",-1)])]),_:1},8,["loading"]),e(y,{onClick:h},{default:a(()=>[...l[14]||(l[14]=[g("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},oe=A(ee,[["__scopeId","data-v-4599f3f7"]]);export{oe as default};
