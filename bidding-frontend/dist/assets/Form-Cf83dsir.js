import{_ as h,r as _,c as J,a as G,b as z,s as K,k as E,o as p,g as l,w as n,e as r,E as m,f as Q,d as g,m as S,j as c,F as W,v as X,t as D,h as k}from"./index-Dg0MfX17.js";import{a as Z,u as $,c as ee,p as le}from"./announcement-BREv7e2N.js";import{f as te}from"./supplier-Brz4Qjp8.js";const ae={class:"page-container"},oe={class:"card-header"},ne={__name:"Form",setup(ue){const v=G(),V=Q(),I=_(null),i=_(!1),N=_([]),b=_({}),s=J(()=>!!v.params.id),t=z({announcementNo:"",title:"",type:"BID",projectName:"",projectBudget:0,region:"",industry:"",bidDeadline:"",contactPerson:"",contactPhone:"",visibilityLevel:"PUBLIC",visibleSupplierIds:[],isTop:0,content:""}),B={announcementNo:[{required:!0,message:"请输入公告编号",trigger:"blur"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],type:[{required:!0,message:"请选择公告类型",trigger:"change"}],projectName:[{required:!0,message:"请输入项目名称",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}]},C=async()=>{try{N.value=await te()}catch(o){console.error("加载供应商列表失败",o)}},w=async()=>{if(s.value)try{const o=await Z(v.params.id);b.value=o,Object.assign(t,o),o.visibleSupplierIds&&(t.visibleSupplierIds=JSON.parse(o.visibleSupplierIds))}catch(o){console.error("加载数据失败",o),m.error("加载公告数据失败")}},L=async()=>{try{await I.value.validate(),i.value=!0;const o={...t};o.visibleSupplierIds&&o.visibleSupplierIds.length>0?o.visibleSupplierIds=JSON.stringify(o.visibleSupplierIds):o.visibleSupplierIds=null,s.value?(await $(v.params.id,o),m.success("更新成功")):(await ee(o),m.success("创建成功")),V.push("/announcements")}catch(o){o.message&&m.error(o.message),console.error("提交失败",o)}finally{i.value=!1}},P=async()=>{try{i.value=!0,await le(v.params.id),m.success("发布成功"),V.push("/announcements")}catch(o){o.message&&m.error(o.message),console.error("发布失败",o)}finally{i.value=!1}},R=()=>{V.back()},j=o=>({DRAFT:"草稿",PUBLISHED:"已发布",CLOSED:"已关闭"})[o]||o,A=o=>({DRAFT:"info",PUBLISHED:"success",CLOSED:"danger"})[o]||"info";return K(()=>{C(),w()}),(o,e)=>{const x=r("el-tag"),d=r("el-input"),u=r("el-form-item"),f=r("el-option"),U=r("el-select"),F=r("el-input-number"),q=r("el-date-picker"),T=r("el-radio"),H=r("el-radio-group"),M=r("el-switch"),y=r("el-button"),O=r("el-form"),Y=r("el-card");return p(),E("div",ae,[l(Y,null,{header:n(()=>[k("div",oe,[k("span",null,D(s.value?"编辑招标公告":"新建招标公告"),1),s.value&&b.value.status?(p(),g(x,{key:0,type:A(b.value.status)},{default:n(()=>[c(D(j(b.value.status)),1)]),_:1},8,["type"])):S("",!0)])]),default:n(()=>[l(O,{ref_key:"formRef",ref:I,model:t,rules:B,"label-width":"120px"},{default:n(()=>[l(u,{label:"公告编号",prop:"announcementNo"},{default:n(()=>[l(d,{modelValue:t.announcementNo,"onUpdate:modelValue":e[0]||(e[0]=a=>t.announcementNo=a),placeholder:"请输入公告编号",disabled:s.value},null,8,["modelValue","disabled"])]),_:1}),l(u,{label:"标题",prop:"title"},{default:n(()=>[l(d,{modelValue:t.title,"onUpdate:modelValue":e[1]||(e[1]=a=>t.title=a),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),l(u,{label:"公告类型",prop:"type"},{default:n(()=>[l(U,{modelValue:t.type,"onUpdate:modelValue":e[2]||(e[2]=a=>t.type=a),placeholder:"请选择公告类型",disabled:s.value},{default:n(()=>[l(f,{label:"招标公告",value:"BID"}),l(f,{label:"变更公告",value:"CHANGE"}),l(f,{label:"终止公告",value:"TERMINATE"}),l(f,{label:"中标结果",value:"RESULT"})]),_:1},8,["modelValue","disabled"])]),_:1}),l(u,{label:"项目名称",prop:"projectName"},{default:n(()=>[l(d,{modelValue:t.projectName,"onUpdate:modelValue":e[3]||(e[3]=a=>t.projectName=a),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),l(u,{label:"项目预算",prop:"projectBudget"},{default:n(()=>[l(F,{modelValue:t.projectBudget,"onUpdate:modelValue":e[4]||(e[4]=a=>t.projectBudget=a),min:0,precision:2},null,8,["modelValue"])]),_:1}),l(u,{label:"地区",prop:"region"},{default:n(()=>[l(d,{modelValue:t.region,"onUpdate:modelValue":e[5]||(e[5]=a=>t.region=a),placeholder:"请输入地区"},null,8,["modelValue"])]),_:1}),l(u,{label:"行业",prop:"industry"},{default:n(()=>[l(d,{modelValue:t.industry,"onUpdate:modelValue":e[6]||(e[6]=a=>t.industry=a),placeholder:"请输入行业"},null,8,["modelValue"])]),_:1}),l(u,{label:"投标截止时间",prop:"bidDeadline"},{default:n(()=>[l(q,{modelValue:t.bidDeadline,"onUpdate:modelValue":e[7]||(e[7]=a=>t.bidDeadline=a),type:"datetime",placeholder:"选择日期时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(u,{label:"联系人",prop:"contactPerson"},{default:n(()=>[l(d,{modelValue:t.contactPerson,"onUpdate:modelValue":e[8]||(e[8]=a=>t.contactPerson=a),placeholder:"请输入联系人"},null,8,["modelValue"])]),_:1}),l(u,{label:"联系电话",prop:"contactPhone"},{default:n(()=>[l(d,{modelValue:t.contactPhone,"onUpdate:modelValue":e[9]||(e[9]=a=>t.contactPhone=a),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),l(u,{label:"可见级别",prop:"visibilityLevel"},{default:n(()=>[l(H,{modelValue:t.visibilityLevel,"onUpdate:modelValue":e[10]||(e[10]=a=>t.visibilityLevel=a)},{default:n(()=>[l(T,{label:"PUBLIC"},{default:n(()=>[...e[14]||(e[14]=[c("公开",-1)])]),_:1}),l(T,{label:"RESTRICTED"},{default:n(()=>[...e[15]||(e[15]=[c("受限",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t.visibilityLevel==="RESTRICTED"?(p(),g(u,{key:0,label:"可见供应商",prop:"visibleSupplierIds"},{default:n(()=>[l(U,{modelValue:t.visibleSupplierIds,"onUpdate:modelValue":e[11]||(e[11]=a=>t.visibleSupplierIds=a),multiple:"",placeholder:"请选择可见供应商",style:{width:"100%"}},{default:n(()=>[(p(!0),E(W,null,X(N.value,a=>(p(),g(f,{key:a.id,label:a.companyName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):S("",!0),l(u,{label:"是否置顶",prop:"isTop"},{default:n(()=>[l(M,{modelValue:t.isTop,"onUpdate:modelValue":e[12]||(e[12]=a=>t.isTop=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),l(u,{label:"内容",prop:"content"},{default:n(()=>[l(d,{modelValue:t.content,"onUpdate:modelValue":e[13]||(e[13]=a=>t.content=a),type:"textarea",rows:10,placeholder:"请输入公告内容"},null,8,["modelValue"])]),_:1}),l(u,null,{default:n(()=>[l(y,{type:"primary",onClick:L,loading:i.value},{default:n(()=>[c(D(s.value?"更新":"创建"),1)]),_:1},8,["loading"]),s.value&&b.value.status==="DRAFT"?(p(),g(y,{key:0,type:"success",onClick:P,loading:i.value},{default:n(()=>[...e[16]||(e[16]=[c(" 发布 ",-1)])]),_:1},8,["loading"])):S("",!0),l(y,{onClick:R},{default:n(()=>[...e[17]||(e[17]=[c("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},ie=h(ne,[["__scopeId","data-v-adad26ec"]]);export{ie as default};
