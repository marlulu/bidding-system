import{_ as B,r as g,c as M,a as O,b as P,s as A,k as V,o as p,g as l,w as a,e as s,f as F,d as N,m as q,j as d,F as D,v as Y,h,t as j,E as w}from"./index-Dg0MfX17.js";import{a as J,u as z,c as G}from"./notice-CKDF6Ln0.js";import{f as H}from"./supplier-Brz4Qjp8.js";const K={class:"page-container"},Q={__name:"Form",setup(W){const i=O(),f=F(),_=g(null),c=g(!1),y=g([]),m=M(()=>!!i.params.id),o=P({title:"",type:"SYSTEM",targetType:"ALL",targetSupplierIds:[],content:""}),k={title:[{required:!0,message:"请输入标题",trigger:"blur"}],type:[{required:!0,message:"请选择通知类型",trigger:"change"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},E=async()=>{try{y.value=await H()}catch(e){console.error("加载供应商列表失败",e)}},T=async()=>{if(m.value)try{const e=await J(i.params.id);if(e.targetSupplierIds)try{e.targetSupplierIds=JSON.parse(e.targetSupplierIds)}catch{e.targetSupplierIds=[]}else e.targetSupplierIds=[];Object.assign(o,e)}catch(e){console.error("加载数据失败",e)}},C=async()=>{try{await _.value.validate(),c.value=!0;const e={...o};e.targetSupplierIds&&e.targetSupplierIds.length>0?e.targetSupplierIds=JSON.stringify(e.targetSupplierIds):e.targetSupplierIds=null,m.value?(await z(i.params.id,e),w.success("更新成功")):(await G(e),w.success("创建成功")),f.push("/notices")}catch(e){console.error("提交失败",e)}finally{c.value=!1}},L=()=>{f.back()};return A(async()=>{await E(),await T()}),(e,t)=>{const S=s("el-input"),n=s("el-form-item"),u=s("el-option"),b=s("el-select"),v=s("el-radio"),U=s("el-radio-group"),I=s("el-button"),x=s("el-form"),R=s("el-card");return p(),V("div",K,[l(R,null,{header:a(()=>[h("span",null,j(m.value?"编辑系统通知":"新建系统通知"),1)]),default:a(()=>[l(x,{ref_key:"formRef",ref:_,model:o,rules:k,"label-width":"120px"},{default:a(()=>[l(n,{label:"标题",prop:"title"},{default:a(()=>[l(S,{modelValue:o.title,"onUpdate:modelValue":t[0]||(t[0]=r=>o.title=r),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),l(n,{label:"通知类型",prop:"type"},{default:a(()=>[l(b,{modelValue:o.type,"onUpdate:modelValue":t[1]||(t[1]=r=>o.type=r),placeholder:"请选择通知类型"},{default:a(()=>[l(u,{label:"系统通知",value:"SYSTEM"}),l(u,{label:"政策变动",value:"POLICY"}),l(u,{label:"公告提醒",value:"ANNOUNCEMENT"})]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"目标类型",prop:"targetType"},{default:a(()=>[l(U,{modelValue:o.targetType,"onUpdate:modelValue":t[2]||(t[2]=r=>o.targetType=r)},{default:a(()=>[l(v,{label:"ALL"},{default:a(()=>[...t[5]||(t[5]=[d("全部用户",-1)])]),_:1}),l(v,{label:"SUPPLIER"},{default:a(()=>[...t[6]||(t[6]=[d("指定供应商",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o.targetType==="SUPPLIER"?(p(),N(n,{key:0,label:"目标供应商",prop:"targetSupplierIds"},{default:a(()=>[l(b,{modelValue:o.targetSupplierIds,"onUpdate:modelValue":t[3]||(t[3]=r=>o.targetSupplierIds=r),multiple:"",placeholder:"请选择目标供应商",style:{width:"100%"}},{default:a(()=>[(p(!0),V(D,null,Y(y.value,r=>(p(),N(u,{key:r.id,label:r.companyName,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):q("",!0),l(n,{label:"内容",prop:"content"},{default:a(()=>[l(S,{modelValue:o.content,"onUpdate:modelValue":t[4]||(t[4]=r=>o.content=r),type:"textarea",rows:10,placeholder:"请输入通知内容"},null,8,["modelValue"])]),_:1}),l(n,null,{default:a(()=>[l(I,{type:"primary",onClick:C,loading:c.value},{default:a(()=>[...t[7]||(t[7]=[d("提交",-1)])]),_:1},8,["loading"]),l(I,{onClick:L},{default:a(()=>[...t[8]||(t[8]=[d("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},ee=B(Q,[["__scopeId","data-v-e1e14250"]]);export{ee as default};
