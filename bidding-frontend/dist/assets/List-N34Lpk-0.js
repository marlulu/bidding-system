import{_ as ge,u as ve,r as x,b as j,s as be,k as w,o as s,h as i,g as t,D as xe,w as a,e as o,G as we,d as m,m as _,f as Ee,F as I,v as z,i as u,H as ke,j as r,I as Ve,t as f,z as De,A as Ce,B as Te,J as Ae,E,K as R}from"./index-Dg0MfX17.js";import{g as Be,d as Se,p as Ue}from"./announcement-BREv7e2N.js";import{c as he,e as Le,g as Ie}from"./expert-CPqleW9Y.js";const ze={class:"announcement-list container"},Re={class:"card-header"},Ne={class:"card-title"},He={key:0,class:"card-tag"},Fe=["onClick"],Me={class:"type-badge"},$e={class:"info"},Pe={class:"price"},Ge={class:"card-footer"},je={class:"pagination"},Oe={__name:"List",setup(Je){const U=Ee(),y=ve(),h=x(!1),T=x([]),D=x(!1),k=x(1),N=x(null),H=x([]),A=x(!1),O=["信息技术","建筑工程","医疗器械","办公用品","咨询服务","物流运输"],J=["北京","上海","广州","深圳","杭州","成都","武汉"],d=j({industry:"",region:"",type:"",status:"",keyword:""}),c=j({page:1,size:9,total:0}),g=async()=>{h.value=!0;try{const n=await Be({page:c.page,size:c.size,...d});T.value=n.records,c.total=n.total;for(const e of T.value)e.hasExtractedExperts=await he(e.id)}catch(n){console.error("加载列表失败",n)}finally{h.value=!1}},K=()=>{c.page=1,g()},F=n=>{U.push(`/announcements/detail/${n}`)},q=async(n,e)=>{switch(n){case"edit":U.push(`/announcements/edit/${e}`);break;case"publish":await Q(e);break;case"close":await W();break;case"delete":await X(e);break;case"extractExperts":ne(e);break;case"viewExtractedExperts":se(e);break}},Q=async n=>{try{await R.confirm("确定要发布该公告吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ue(n),E.success("发布成功"),g()}catch(e){e!=="cancel"&&console.error("发布失败",e)}},W=async n=>{try{await R.confirm("确定要关闭该公告吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),E.success("关闭成功"),g()}catch(e){e!=="cancel"&&console.error("关闭失败",e)}},X=async n=>{try{await R.confirm("确定要删除该公告吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Se(n),E.success("删除成功"),g()}catch(e){e!=="cancel"&&console.error("删除失败",e)}},Y=n=>n?n.toLocaleString():"面议",Z=n=>n?n.split(" ")[0]:"-",ee=n=>({BID:"招标公告",CHANGE:"变更公告",TERMINATE:"终止公告",RESULT:"中标公示"})[n]||n,te=n=>({DRAFT:"草稿",PUBLISHED:"已发布",CLOSED:"已关闭"})[n]||n,le=n=>({BID:"",CHANGE:"warning",TERMINATE:"danger",RESULT:"success"})[n]||"",ae=n=>({DRAFT:"info",PUBLISHED:"success",CLOSED:"danger"})[n]||"info",ne=n=>{N.value=n,k.value=1,D.value=!0},oe=async()=>{if(k.value<1||k.value>10){E.warning("抽取数量必须在1到10之间");return}try{await Le(N.value,k.value),E.success("专家抽取成功"),D.value=!1,g()}catch(n){E.error(n.message||"专家抽取失败")}},se=async n=>{try{const e=await Ie(n);H.value=e,A.value=!0}catch(e){E.error(e.message||"获取已抽取专家失败")}};return be(()=>{g()}),(n,e)=>{const p=o("el-option"),B=o("el-select"),v=o("el-form-item"),C=o("el-icon"),b=o("el-button"),re=o("el-input"),M=o("el-form"),$=o("el-card"),V=o("el-dropdown-item"),ue=o("el-dropdown-menu"),de=o("el-dropdown"),P=o("el-tag"),ie=o("el-col"),ce=o("el-row"),pe=o("el-empty"),me=o("el-pagination"),_e=o("el-input-number"),G=o("el-dialog"),S=o("el-table-column"),fe=o("el-table"),ye=we("loading");return s(),w("div",ze,[e[24]||(e[24]=i("h1",{class:"page-title"},"招标信息门户",-1)),t($,{class:"filter-card",shadow:"never"},{default:a(()=>[t(M,{inline:!0,model:d},{default:a(()=>[t(v,{label:"行业分类"},{default:a(()=>[t(B,{modelValue:d.industry,"onUpdate:modelValue":e[0]||(e[0]=l=>d.industry=l),placeholder:"全部行业",clearable:"",style:{width:"150px"}},{default:a(()=>[(s(),w(I,null,z(O,l=>t(p,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"地区"},{default:a(()=>[t(B,{modelValue:d.region,"onUpdate:modelValue":e[1]||(e[1]=l=>d.region=l),placeholder:"全部地区",clearable:"",style:{width:"150px"}},{default:a(()=>[(s(),w(I,null,z(J,l=>t(p,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"公告类型"},{default:a(()=>[t(B,{modelValue:d.type,"onUpdate:modelValue":e[2]||(e[2]=l=>d.type=l),placeholder:"全部类型",clearable:"",style:{width:"150px"}},{default:a(()=>[t(p,{label:"招标公告",value:"BID"}),t(p,{label:"变更公告",value:"CHANGE"}),t(p,{label:"终止公告",value:"TERMINATE"}),t(p,{label:"中标公示",value:"RESULT"})]),_:1},8,["modelValue"])]),_:1}),u(y).isAdmin()?(s(),m(v,{key:0},{default:a(()=>[t(B,{modelValue:d.status,"onUpdate:modelValue":e[3]||(e[3]=l=>d.status=l),placeholder:"公告状态",clearable:"",style:{width:"150px"}},{default:a(()=>[t(p,{label:"草稿",value:"DRAFT"}),t(p,{label:"已发布",value:"PUBLISHED"}),t(p,{label:"已关闭",value:"CLOSED"})]),_:1},8,["modelValue"])]),_:1})):_("",!0),t(v,null,{default:a(()=>[t(re,{modelValue:d.keyword,"onUpdate:modelValue":e[4]||(e[4]=l=>d.keyword=l),placeholder:"搜索项目名称/编号",clearable:"",style:{width:"250px"}},{append:a(()=>[t(b,{onClick:K},{default:a(()=>[t(C,null,{default:a(()=>[t(u(ke))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),u(y).isAdmin()?(s(),m(v,{key:1},{default:a(()=>[t(b,{type:"success",onClick:e[5]||(e[5]=l=>u(U).push("/announcements/create"))},{default:a(()=>[...e[13]||(e[13]=[r("发布公告",-1)])]),_:1})]),_:1})):_("",!0)]),_:1},8,["model"])]),_:1}),xe((s(),w("div",null,[t(ce,{gutter:20},{default:a(()=>[(s(!0),w(I,null,z(T.value,l=>(s(),m(ie,{xs:24,sm:12,md:8,key:l.id},{default:a(()=>[t($,{class:"card-item announcement-card",shadow:"hover"},Ve({default:a(()=>[!u(y).isAdmin()&&l.isTop?(s(),w("div",He,"置顶")):_("",!0),u(y).isAdmin()?_("",!0):(s(),w("h3",{key:1,class:"title",onClick:L=>F(l.id)},f(l.title),9,Fe)),i("div",Me,[t(P,{type:le(l.type),size:"small"},{default:a(()=>[r(f(ee(l.type)),1)]),_:2},1032,["type"]),u(y).isAdmin()?(s(),m(P,{key:0,type:ae(l.status),size:"small",style:{"margin-left":"5px"}},{default:a(()=>[r(f(te(l.status)),1)]),_:2},1032,["type"])):_("",!0)]),i("div",$e,[i("p",null,[t(C,null,{default:a(()=>[t(u(De))]),_:1}),r(" 地区："+f(l.region||"全国"),1)]),i("p",null,[t(C,null,{default:a(()=>[t(u(Ce))]),_:1}),e[20]||(e[20]=r(" 预算：",-1)),i("span",Pe,"￥"+f(Y(l.projectBudget)),1)]),i("p",null,[t(C,null,{default:a(()=>[t(u(Te))]),_:1}),r(" 截止："+f(Z(l.bidDeadline)),1)])]),i("div",Ge,[t(b,{type:"primary",link:"",onClick:L=>F(l.id)},{default:a(()=>[r(f(u(y).isAdmin()?"查看详情":"立即投标"),1)]),_:1},8,["onClick"])])]),_:2},[u(y).isAdmin()?{name:"header",fn:a(()=>[i("div",Re,[i("span",Ne,f(l.title),1),t(de,{trigger:"click",onCommand:L=>q(L,l.id)},{dropdown:a(()=>[t(ue,null,{default:a(()=>[t(V,{command:"edit"},{default:a(()=>[...e[14]||(e[14]=[r("编辑",-1)])]),_:1}),l.status==="DRAFT"?(s(),m(V,{key:0,command:"publish"},{default:a(()=>[...e[15]||(e[15]=[r("发布",-1)])]),_:1})):_("",!0),l.status==="PUBLISHED"?(s(),m(V,{key:1,command:"close"},{default:a(()=>[...e[16]||(e[16]=[r("关闭",-1)])]),_:1})):_("",!0),t(V,{command:"delete"},{default:a(()=>[...e[17]||(e[17]=[r("删除",-1)])]),_:1}),l.hasExtractedExperts?(s(),m(V,{key:3,command:"viewExtractedExperts"},{default:a(()=>[...e[19]||(e[19]=[r("查看专家",-1)])]),_:1})):(s(),m(V,{key:2,command:"extractExperts"},{default:a(()=>[...e[18]||(e[18]=[r("抽取专家",-1)])]),_:1}))]),_:2},1024)]),default:a(()=>[t(b,{type:"primary",link:"",size:"small"},{default:a(()=>[t(C,null,{default:a(()=>[t(u(Ae))]),_:1})]),_:1})]),_:2},1032,["onCommand"])])]),key:"0"}:void 0]),1024)]),_:2},1024))),128))]),_:1}),T.value.length===0?(s(),m(pe,{key:0,description:"暂无相关招标信息"})):_("",!0),i("div",je,[t(me,{"current-page":c.page,"onUpdate:currentPage":e[6]||(e[6]=l=>c.page=l),"page-size":c.size,"onUpdate:pageSize":e[7]||(e[7]=l=>c.size=l),total:c.total,layout:"total, prev, pager, next, jumper",onCurrentChange:g},null,8,["current-page","page-size","total"])])])),[[ye,h.value]]),t(G,{modelValue:D.value,"onUpdate:modelValue":e[10]||(e[10]=l=>D.value=l),title:"抽取专家",width:"30%",center:""},{footer:a(()=>[t(b,{onClick:e[9]||(e[9]=l=>D.value=!1)},{default:a(()=>[...e[21]||(e[21]=[r("取消",-1)])]),_:1}),t(b,{type:"primary",onClick:oe},{default:a(()=>[...e[22]||(e[22]=[r("确定抽取",-1)])]),_:1})]),default:a(()=>[t(M,{"label-width":"100px"},{default:a(()=>[t(v,{label:"抽取数量"},{default:a(()=>[t(_e,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=l=>k.value=l),min:1,max:10},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(G,{modelValue:A.value,"onUpdate:modelValue":e[12]||(e[12]=l=>A.value=l),title:"已抽取专家列表",width:"50%",center:""},{footer:a(()=>[t(b,{type:"primary",onClick:e[11]||(e[11]=l=>A.value=!1)},{default:a(()=>[...e[23]||(e[23]=[r("关闭",-1)])]),_:1})]),default:a(()=>[t(fe,{data:H.value,border:"",style:{width:"100%"}},{default:a(()=>[t(S,{prop:"name",label:"专家姓名"}),t(S,{prop:"specialty",label:"专业领域"}),t(S,{prop:"title",label:"职称"}),t(S,{prop:"phone",label:"联系电话"})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}},We=ge(Oe,[["__scopeId","data-v-eb35b454"]]);export{We as default};
