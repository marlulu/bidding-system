import{r as U}from"./request-CvP5yQdq.js";import{a as K}from"./supplier-B0q6gocU.js";import{_ as Q,r as _,a as S,j as W,c as L,o as d,d as l,w as a,e as s,n as X,b as Y,p as Z,g as n,k as y,l as E,t as ee,F as le,s as te,E as I,q as ae}from"./index-BfjmpUK-.js";function oe(p){return U({url:"/users",method:"get",params:p})}function re(p){return U({url:"/users",method:"post",data:p})}function se(p){return U({url:`/users/${p}`,method:"delete"})}function ne(p,v){return U({url:`/users/${p}/status`,method:"put",data:{status:v}})}const ue={class:"page-container"},de={class:"search-bar"},pe={__name:"List",setup(p){const v=_(!1),N=_([]),w=_(!1),x=_(!1),h=_(null),P=_([]),i=S({keyword:"",role:""}),u=S({page:1,size:10,total:0}),o=S({username:"",password:"",realName:"",phone:"",email:"",role:"SUPPLIER",supplierId:null,status:1}),D={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},f=async()=>{v.value=!0;try{const r=await oe({page:u.page,size:u.size,keyword:i.keyword,role:i.role});N.value=r.records,u.total=r.total}catch(r){console.error("加载数据失败",r)}finally{v.value=!1}},R=async()=>{try{P.value=await K()}catch(r){console.error("加载供应商列表失败",r)}},z=()=>{u.page=1,f()},B=()=>{i.keyword="",i.role="",z()},q=()=>{Object.assign(o,{username:"",password:"",realName:"",phone:"",email:"",role:"SUPPLIER",supplierId:null,status:1}),w.value=!0},M=async()=>{try{await h.value.validate(),x.value=!0,await re(o),I.success("创建成功"),w.value=!1,f()}catch(r){console.error("提交失败",r)}finally{x.value=!1}},T=async r=>{try{const e=r.status===1?0:1;await ne(r.id,e),I.success("状态更新成功"),f()}catch(e){console.error("更新状态失败",e)}},$=async r=>{try{await ae.confirm("确认删除该用户吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await se(r),I.success("删除成功"),f()}catch(e){e!=="cancel"&&console.error("删除失败",e)}};return W(()=>{f(),R()}),(r,e)=>{const b=s("el-input"),V=s("el-option"),C=s("el-select"),g=s("el-button"),m=s("el-table-column"),k=s("el-tag"),j=s("el-table"),A=s("el-pagination"),F=s("el-card"),c=s("el-form-item"),O=s("el-form"),G=s("el-dialog"),H=X("loading");return d(),L("div",ue,[l(F,null,{default:a(()=>[Y("div",de,[l(b,{modelValue:i.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>i.keyword=t),placeholder:"搜索用户名、真实姓名、手机号",style:{width:"300px","margin-right":"10px"},clearable:""},null,8,["modelValue"]),l(C,{modelValue:i.role,"onUpdate:modelValue":e[1]||(e[1]=t=>i.role=t),placeholder:"角色",style:{width:"150px","margin-right":"10px"},clearable:""},{default:a(()=>[l(V,{label:"管理员",value:"ADMIN"}),l(V,{label:"供应商",value:"SUPPLIER"})]),_:1},8,["modelValue"]),l(g,{type:"primary",onClick:z},{default:a(()=>[...e[13]||(e[13]=[n("搜索",-1)])]),_:1}),l(g,{onClick:B},{default:a(()=>[...e[14]||(e[14]=[n("重置",-1)])]),_:1}),l(g,{type:"success",onClick:q,style:{float:"right"}},{default:a(()=>[...e[15]||(e[15]=[n("新建用户",-1)])]),_:1})]),Z((d(),y(j,{data:N.value,style:{width:"100%","margin-top":"20px"}},{default:a(()=>[l(m,{prop:"username",label:"用户名",width:"150"}),l(m,{prop:"realName",label:"真实姓名",width:"120"}),l(m,{prop:"phone",label:"手机号",width:"130"}),l(m,{prop:"email",label:"邮箱","min-width":"180"}),l(m,{prop:"role",label:"角色",width:"100"},{default:a(({row:t})=>[t.role==="ADMIN"?(d(),y(k,{key:0,type:"danger"},{default:a(()=>[...e[16]||(e[16]=[n("管理员",-1)])]),_:1})):t.role==="SUPPLIER"?(d(),y(k,{key:1,type:"primary"},{default:a(()=>[...e[17]||(e[17]=[n("供应商",-1)])]),_:1})):E("",!0)]),_:1}),l(m,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[t.status===1?(d(),y(k,{key:0,type:"success"},{default:a(()=>[...e[18]||(e[18]=[n("启用",-1)])]),_:1})):(d(),y(k,{key:1,type:"danger"},{default:a(()=>[...e[19]||(e[19]=[n("禁用",-1)])]),_:1}))]),_:1}),l(m,{prop:"createTime",label:"创建时间",width:"180"}),l(m,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(g,{link:"",type:"primary",onClick:J=>T(t)},{default:a(()=>[n(ee(t.status===1?"禁用":"启用"),1)]),_:2},1032,["onClick"]),l(g,{link:"",type:"danger",onClick:J=>$(t.id)},{default:a(()=>[...e[20]||(e[20]=[n("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,v.value]]),l(A,{"current-page":u.page,"onUpdate:currentPage":e[2]||(e[2]=t=>u.page=t),"page-size":u.size,"onUpdate:pageSize":e[3]||(e[3]=t=>u.size=t),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),l(G,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=t=>w.value=t),title:"新建用户",width:"500px"},{footer:a(()=>[l(g,{onClick:e[11]||(e[11]=t=>w.value=!1)},{default:a(()=>[...e[21]||(e[21]=[n("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:M,loading:x.value},{default:a(()=>[...e[22]||(e[22]=[n("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(O,{ref_key:"formRef",ref:h,model:o,rules:D,"label-width":"100px"},{default:a(()=>[l(c,{label:"用户名",prop:"username"},{default:a(()=>[l(b,{modelValue:o.username,"onUpdate:modelValue":e[4]||(e[4]=t=>o.username=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(c,{label:"密码",prop:"password"},{default:a(()=>[l(b,{modelValue:o.password,"onUpdate:modelValue":e[5]||(e[5]=t=>o.password=t),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),l(c,{label:"真实姓名",prop:"realName"},{default:a(()=>[l(b,{modelValue:o.realName,"onUpdate:modelValue":e[6]||(e[6]=t=>o.realName=t),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),l(c,{label:"手机号",prop:"phone"},{default:a(()=>[l(b,{modelValue:o.phone,"onUpdate:modelValue":e[7]||(e[7]=t=>o.phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(c,{label:"邮箱",prop:"email"},{default:a(()=>[l(b,{modelValue:o.email,"onUpdate:modelValue":e[8]||(e[8]=t=>o.email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(c,{label:"角色",prop:"role"},{default:a(()=>[l(C,{modelValue:o.role,"onUpdate:modelValue":e[9]||(e[9]=t=>o.role=t),placeholder:"请选择角色",style:{width:"100%"}},{default:a(()=>[l(V,{label:"管理员",value:"ADMIN"}),l(V,{label:"供应商",value:"SUPPLIER"})]),_:1},8,["modelValue"])]),_:1}),o.role==="SUPPLIER"?(d(),y(c,{key:0,label:"关联供应商",prop:"supplierId"},{default:a(()=>[l(C,{modelValue:o.supplierId,"onUpdate:modelValue":e[10]||(e[10]=t=>o.supplierId=t),placeholder:"请选择供应商",style:{width:"100%"}},{default:a(()=>[(d(!0),L(le,null,te(P.value,t=>(d(),y(V,{key:t.id,label:t.companyName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ge=Q(pe,[["__scopeId","data-v-0b13ee7a"]]);export{ge as default};
